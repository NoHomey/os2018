# Упражнение 7

[Упражнение 7 - слайдове](https://gitpitch.com/adUst0/os2018/master?p=ex07/slides/ "ex07")

---

`true` - команда която винаги завършва успешно  
`false` - команда която винаги завършва неуспешно  

## I. Условен оператор и проверка на условия

### 1. Оператор if

**NB1.** Exit status 0 означава true. Всичко останало е false.  

**NB2.** Кода на завършване на if-а е кода на последната изпълнена команда от този if или 0, ако нито едно условие не е истина и няма else. 

**if** *списък_команди1*  
**then** *списък_команди2*  
[**elif** *списък_команди3*  
**then** *списък_команди4*] ...  
[**else** *списък_команди5*]  
**fi**  

Условието се оценява на истина, ако последната команда в списъка завърши успешно. (Exit status 0).

Пример:

```shell
if true; false; then echo Yes; else echo No; fi # No
if false; true; then echo Yes; else echo No; fi # Yes
```

*Задача*: КП, която приема като аргумент име на потребител и отпечатва съобщение, ако този потребител не съществува:

```shell
if grep "^$1:" /etc/passwd > /dev/null 2>&1; then
    :
else
    echo "No user $1"
fi
```

### 2. Команда test

`test условие` или `[ условие ]`

! (логическо отрицание)  
-a (логическо AND)  
-o (логическо OR)  

#### 2.1 Условия за файлове

| Условие | Значение |
|--|--|
| -e файл | истина, ако файл съществува |
| -f файл | истина, ако файл съществува и е обикновен файл |
| -d файл | истина, ако файл съществува и е директория |
| -s файл | истина, ако файл не е празен |
| -r файл | истина, ако потребителят, изпълняващ test, има read права |
| -w файл | истина, ако потребителят, изпълняващ test, има write права |
| -x файл | истина, ако потребителят, изпълняващ test, има execute права |
| файл1 -nt файл2 | истина, ако файл1 е по-нов от файл2, според датата на последната промяна |
| файл1 -оt файл2 | истина, ако файл1 е по-стар от файл2, според датата на последната промяна |

#### 2.2 Условия за стрингове

 - `str1 {=|!=} str2`
 - `[-n] str` - истина, ако str != ""
 - `-z str` - истина, ако str = ""

#### 2.3 Условия за сравнения на числа

| Конструкция| Значение |
|--|--|
| n1 -eq n2 | n1 == n2 |
| n1 -ne n2 | n1 != n2 |
| n1 -lt n2 | n1 < n2 |
| n1 -le n2 | n1 <= n2 |
| n1 -gt n2 | n1 > n2 |
| n1 -ge n2 | n1 >= n2 |

### 3. Оператор [[ ]]
`[[ условие ]]` - подобрение на test

Подобрения: 

 - `||, &&`
 - `str1 == str2`
 - `str1 {<|>} str2`

## II. Цикли

### 1. Цикъл for

**for** променлива [**in** списък]  
**do** списък_команди  
**done**  

### 2. Цикли while и until

**while**  списък_команди1  
**do**  списък_команди2  
**done**   
  
**until**  списък_команди1  
**do**  списък_команди2  
**done**  

### 3. break и continue
`break [N]` - прекъсва цикъл  
`continue [N]` - цикалът продължава със следващата итерация  

**N** - на колко нива да се изпълни break или continue (в термините на вложени цикли). По подразбиране N = 1. 

## III. Команда exit

`exit [N]` - Приключва изпълнението на КП. Ако N е пропуснато, кодът на завършване е кодът на последната завършила команда. 

**NB.** Ако нямаме exit в КП, кодът на завършване на КП е кодът на последната завършила команда.

## IV. Задачи

1. (USERLOG) Да се състави командна процедура, която получава при стартиране като параметър в командния ред идентификатор на потребител. Процедурата периодично проверява дали потребителят е стартирал сесия, в който случай прекратява проверката, извеждайки на стандартния изход подходящо съобщение.

2. (STRING_SEARCH) Да се състави командна процедура, която получава като параметри в командния ред при стартиране имена на съществуващи текстови файлове. Процедурата прочита от стандартния вход символен низ и за всеки от зададените файлове извежда по подходящ начин на стандартния изход броя на редовете, които съдържат низа.

**Забележка:** Идеята е да упражним цикли. В противен случай, grep -c ще ни свърши същата работа.

3. (MESS_USERS) Да се състави командна процедура, която получава като параметри в командния ред при стартиране списък от идентификатори на потребители на системата. Процедурата прочита съобщение (текст) от стандартния вход и го изпраща на онези от потребителите от списъка, които са стартирали и работят в сесия.

4. (CHECKSIZE) Да се състави командна процедура, която получава в командния ред при стартиране два параметъра – първият от които – символен низ, а вторият – число. Ако съществува директория с име, съвпадащо с низа, процедурата извежда на стандартния изход имената на всички обикновени файлове в нея, които имат размер по-голям от подаденото число. В противен случай (ако не съществува такава директория) – на стандартния изход се извежда подходящо съобщение.

5. (LOGINFO) Да се състави командна процедура, която извежда на стандартния изход подходящо оформени текущата дата, информация за стартираните сесии и приветствие.